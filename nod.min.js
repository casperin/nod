// Generated by CoffeeScript 1.6.1
((function(){var a,b,c,d,e=this;a=function(){function a(b,c){var d,e=this;this.run=function(){return a.prototype.run.apply(e,arguments)},d=c[0],this.metric=c[1],this.getVal=this.makeGetVal(b,d)}return a.prototype.run=function(){return this.verify(this.metric,this.getVal())},a.prototype.makeGetVal=function(a,b){var c,d,e;return e=a.attr("type"),e==="checkbox"?function(){return a.is(":checked")}:e==="radio"?(d=a.attr("name"),function(){return jQuery('[name="'+d+'"]').filter(":checked").val()}):this.metric==="one-of"?(c=jQuery(b),function(){return c.map(function(){return jQuery.trim(this.value)}).get().join("")}):function(){return jQuery.trim(a.val())}},a.prototype.verify=function(a,b){var c,d,e,f;if(!!(a&&a.constructor&&a.call&&a.apply))return a(b);if(a instanceof RegExp)return a.test(b);f=jQuery.map(a.split(":"),jQuery.trim),e=f[0],c=f[1],d=f[2];if(e==="same-as"&&jQuery(c).length!==1)throw new Error("same-as selector must target one and only one element");if(!b&&e!=="presence"&&e!=="one-of")return!0;switch(e){case"presence":return!!b;case"one-of":return!!b;case"exact":return b===c;case"not":return b!==c;case"same-as":return b===jQuery(c).val();case"min-num":return+b>=+c;case"max-num":return+b<=+c;case"between-num":return+b>=+c&&+b<=+d;case"min-length":return b.length>=+c;case"max-length":return b.length<=+c;case"exact-length":return b.length===+c;case"between":return b.length>=+c&&b.length<=+d;case"integer":return/^\s*\d+\s*$/.test(b);case"float":return/^[-+]?[0-9]+(\.[0-9]+)?$/.test(b);case"email":return this.email(b);default:throw new Error("I don't know "+e+", sorry.")}},a.prototype.email=function(a){var b;return b=/^([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22))*\x40([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d))*$/,b.test(a)},a}(),$.fn.nod=function(a,b){return new d(this,a,b),this},b=function(){function b(d,e,f){var g=this;this.get=e,this.field=f,this.change_status=function(a){return b.prototype.change_status.apply(g,arguments)},this.runCheck=function(){return b.prototype.runCheck.apply(g,arguments)},this.delayedCheck=function(){return b.prototype.delayedCheck.apply(g,arguments)},this.events=function(){return b.prototype.events.apply(g,arguments)},this.$el=jQuery(d),this.delayId="",this.status=!0,this.checker=new a(this.$el,this.field),this.msg=new c(this.$el,this.get,this.field),this.events()}return b.prototype.events=function(){if(this.$el.attr("type")==="radio")return jQuery('[name="'+this.$el.attr("name")+'"]').on("change",this.runCheck);this.$el.on("change",this.runCheck),this.$el.on("blur",this.runCheck),this.field[1]==="one-of"&&jQuery(window).on("nod-run-one-of",this.runCheck);if(this.get.delay)return this.$el.on("keyup",this.delayedCheck)},b.prototype.delayedCheck=function(){return clearTimeout(this.delayId),this.delayId=setTimeout(this.runCheck,this.get.delay)},b.prototype.runCheck=function(){return jQuery.when(this.checker.run()).then(this.change_status)},b.prototype.change_status=function(a){var b;b=!!a;if(this.status===b)return;this.status=b,this.msg.toggle(this.status),jQuery(this).trigger("nod_toggle");if(this.field[1]==="one-of"&&a)return jQuery(window).trigger("nod-run-one-of")},b}(),c=function(){function a(b,c,d){var e=this;this.$el=b,this.get=c,this.createShowMsg=function(){return a.prototype.createShowMsg.apply(e,arguments)},this.toggle=function(b){return a.prototype.toggle.apply(e,arguments)},this.createMsg=function(b){return a.prototype.createMsg.apply(e,arguments)},this.$msg=this.createMsg(d[2]),this.showMsg=this.createShowMsg()}return a.prototype.createMsg=function(a){return jQuery("<span/>",{html:a,"class":this.get.helpSpanDisplay+" "+this.get.errorClass})},a.prototype.toggle=function(a){if(a)return this.$msg.remove();this.showMsg();if(this.get.broadcastError)return this.broadcast()},a.prototype.createShowMsg=function(){var a,b;return b=this.$el.attr("type"),b==="checkbox"||b==="radio"?function(){return this.$el.parent().append(this.$msg)}:(a=this.findPos(this.$el),function(){return a.after(this.$msg)})},a.prototype.findPos=function(a){return this.elHasClass("parent",a)?this.findPos(a.parent()):this.elHasClass("next",a)?this.findPos(a.next()):a},a.prototype.elHasClass=function(a,b){var c,d,e,f;f=this.get.errorPosClasses;for(d=0,e=f.length;d<e;d++){c=f[d];if(b[a](c).length)return!0}return!1},a.prototype.broadcast=function(){return jQuery(window).trigger("nod_error_fired",{el:this.$el,msg:this.$msg.html()})},a}(),d=function(){function a(b,c,d){var e=this;this.form=b,this.formIsErrorFree=function(){return a.prototype.formIsErrorFree.apply(e,arguments)},this.submitForm=function(){return a.prototype.submitForm.apply(e,arguments)},this.toggleSubmitBtnText=function(){return a.prototype.toggleSubmitBtnText.apply(e,arguments)},this.toggleSubmitBtn=function(){return a.prototype.toggleSubmitBtn.apply(e,arguments)},this.toggleGroupClass=function(b){return a.prototype.toggleGroupClass.apply(e,arguments)},this.toggle_status=function(b){return a.prototype.toggle_status.apply(e,arguments)},this.massCheck=function(b){return a.prototype.massCheck.apply(e,arguments)},this.listenForEnter=function(b){return a.prototype.listenForEnter.apply(e,arguments)},this.events=function(){return a.prototype.events.apply(e,arguments)},this.createListeners=function(b){return a.prototype.createListeners.apply(e,arguments)};if(!c)return;this.get=jQuery.extend({delay:700,disableSubmitBtn:!0,helpSpanDisplay:"help-inline",groupClass:"error",submitBtnSelector:"[type=submit]",metricsSplitter:":",errorPosClasses:[".help-inline",".add-on","button",".input-append"],silentSubmit:!1,broadcastError:!1,errorClass:"nod_msg",groupSelector:".control-group"},d),this.listeners=this.createListeners(c),this.submit=this.form.find(this.get.submitBtnSelector),this.checkIfElementsExist(this.form,this.submit,this.get.disableSubmitBtn),this.events()}return a.prototype.createListeners=function(a){var c,d,e,f,g,h,i,j;e=[];for(f=0,h=a.length;f<h;f++){d=a[f],d.length!==3&&this["throw"]("field",d),j=this.form.find(d[0]);for(g=0,i=j.length;g<i;g++)c=j[g],e.push(new b(c,this.get,d))}return e},a.prototype.events=function(){var a,b,c,d;d=this.listeners;for(b=0,c=d.length;b<c;b++)a=d[b],jQuery(a).on("nod_toggle",this.toggle_status);return this.submit.length?this.submit.on("click",this.massCheck):this.form.on("keyup",this.listenForEnter)},a.prototype.listenForEnter=function(a){if(a.keyCode===13)return this.massCheck()},a.prototype.massCheck=function(a){var b,c,d,e,f;a!=null&&a.preventDefault(),b=[],f=this.listeners;for(d=0,e=f.length;d<e;d++)c=f[d],b.push(c.runCheck());return this.toggleSubmitBtnText(),jQuery.when.apply(window,b).then(this.submitForm).then(this.toggleSubmitBtnText)},a.prototype.toggle_status=function(a){this.toggleGroupClass(a.target.$el.parents(this.get.groupSelector));if(this.get.disableSubmitBtn)return this.toggleSubmitBtn()},a.prototype.toggleGroupClass=function(a){return a.find("."+this.get.errorClass).length?a.addClass(this.get.groupClass):a.removeClass(this.get.groupClass)},a.prototype.toggleSubmitBtn=function(){return this.formIsErrorFree()?this.submit.removeClass("disabled").removeAttr("disabled"):this.submit.addClass("disabled").attr("disabled","disabled")},a.prototype.toggleSubmitBtnText=function(){var a;a=this.submit.attr("data-loading-text");if(a)return this.submit.attr("data-loading-text",this.submit.html()),this.submit.html(a)},a.prototype.submitForm=function(){var a;if(!this.formIsErrorFree())return;return this.get.silentSubmit?(a=jQuery(this.form),a.trigger("silentSubmit",a.serialize())):this.form.submit()},a.prototype.formIsErrorFree=function(){return!jQuery(this.listeners).filter(function(){return!this.status}).length},a.prototype.checkIfElementsExist=function(a,b,c){(!a.selector||!a.length)&&this["throw"]("form",a);if(!b.length&&c)return this["throw"]("submit",b)},a.prototype["throw"]=function(a,b){var c;switch(a){case"form":c="Couldn't find form: ";break;case"submit":c="Couldn't find submit button: ";break;case"field":c="Metrics for each field must have three parts: "}throw new Error(c+b)},a}()})).call(this);